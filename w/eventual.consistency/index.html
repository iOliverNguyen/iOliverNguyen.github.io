<!doctype html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Eventual consistency and cache | Oliver Nguyen</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="all,follow"><meta name="googlebot" content="index,follow,snippet,archive"><meta name="og:site_name" content="Oliver Nguyen"><meta property="og:title" content="Eventual consistency and cache"><meta property="og:description" content="What is it? Eventual consistency is a fancy name of doing something and only expecting the changed state after a while. And there is a guarantee that you will eventually get the expected state. Hence, consistency.
But that won&rsquo;t work well with caching. And I had to deal with that recently when working with WhatsApp API.
When querying for a list of message templates from WhatsApp, we&rsquo;ll cache the response for use later."><meta property="og:type" content="article"><meta property="og:url" content="https://iOliverNguyen.github.io/w/eventual.consistency/"><meta property="og:image" content="https://iOliverNguyen.github.io/w/eventual.consistency/_cover.png"><meta property="article:section" content="w"><meta property="article:published_time" content="2022-02-22T00:00:00+00:00"><meta property="article:modified_time" content="2022-02-22T00:00:00+00:00"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://iOliverNguyen.github.io/w/eventual.consistency/_cover.png"><meta name="twitter:title" content="Eventual consistency and cache"><meta name="twitter:description" content="What is it? Eventual consistency is a fancy name of doing something and only expecting the changed state after a while. And there is a guarantee that you will eventually get the expected state. Hence, consistency.
But that won&rsquo;t work well with caching. And I had to deal with that recently when working with WhatsApp API.
When querying for a list of message templates from WhatsApp, we&rsquo;ll cache the response for use later."><link rel="stylesheet" href="https://iOliverNguyen.github.io/css/style-classic.css"><link rel="stylesheet" href="https://iOliverNguyen.github.io/style.css"><link rel="icon" type="image/png" href="/images/favicon.png"><link href="https://iOliverNguyen.github.io/w/eventual.consistency/index.xml" rel="alternate" type="application/rss+xml" title="Oliver Nguyen"><script async src="https://www.googletagmanager.com/gtag/js?id=G-L5X8RJDCLM"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-L5X8RJDCLM")</script><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Eventual consistency and cache</h1><div class="meta"><div class="postdate"><time datetime="2022-02-22 00:00:00 &#43;0000 UTC" itemprop="datePublished">2022-02-22</time></div><div class="article-tag">&nbsp;Â· <a class="tag-link" href="/w/#cache" rel="tag">cache</a></div><div class="published-at">published at <a target="_blank" href="https://hackernoon.com/what-is-eventually-consistency-and-how-do-you-deal-with-it">Hacker Noon</a></div></div></header><div class="content" itemprop="articleBody"><h2 id="what-is-it">What is it?</h2><p>Eventual consistency is a fancy name of doing something and only expecting the changed state after a while. And there is a guarantee that you will eventually get the expected state. Hence, consistency.</p><p>But that won&rsquo;t work well with <strong>caching</strong>. And I had to deal with that recently when working with WhatsApp API.</p><p>When querying for a list of message templates from WhatsApp, we&rsquo;ll cache the response for use later. It&rsquo;s because message templates are not something that changes so frequently. Just cache it to reduce unnecessary API calls.</p><p>After creating a template, we won&rsquo;t see it for a while if we call the listing API. That&rsquo;s because of, you guessed it, eventual consistency.</p><p>Things will get worse because these responded message templates will be cached for a few minutes. Therefore, we won&rsquo;t see the newly created template soon, even though it may be available on the WhatsApp API earlier.</p><h2 id="how-to-deal-with-it">How to deal with it?</h2><p>First, let&rsquo;s simply ignore the cache for, like 1 minute, after creating a new template. That would be enough for the WhatsApp API to return the newly created template.</p><p>The next improvement would be reducing the cache expiration time to, like 5s, in the first 1 minute. Let&rsquo;s call that the catching-up duration. After that, use the original expiration time.</p><p>Another improvement would be verifying that the new template is available in the response and starting caching at that point. That would be a bit more complex, as we need to store the template id and more code to extract it from the response.</p><p>Finally, while that new template is not available, we can still construct it and manually inject it into our own response.</p><h2 id="recap">Recap</h2><p>In the end, that works well. We can have both cache and eventual consistency playing together, minimizing the waiting time and the number of requests to an external platform! ðŸŽ‰</p><p>Thanks for reading! Would love to hear your thoughts by replying to the tweet.</p><blockquote class="twitter-tweet" data-theme="light"><p lang="en" dir="ltr">My latest article about eventual consistency and cache.<br><a href="https://t.co/RfqE9vF2lb">https://t.co/RfqE9vF2lb</a></p>&mdash; Oliver Nguyen (@_OliverNguyen) <a href="https://x.com/_OliverNguyen/status/1496687455403388929?ref_src=twsrc%5Etfw"></a></blockquote><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><h2 id="author">Author</h2><p>I'm Oliver Nguyen. A software maker working mostly in Go and JavaScript. I enjoy learning and seeing a better version of myself each day. Occasionally spin off new open source projects. Share knowledge and thoughts during my journey. <span>Connect with me on <a class="icon" target="_blank" rel="noopener" href="https://github.com/iOliverNguyen"><i class="fab fa-github"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://linkedin.com/in/iOliverNguyen"><i class="fab fa-linkedin"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://x.com/_OliverNguyen"><i class="fab fa-twitter"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://iOliverNguyen.medium.com"><i class="fab fa-medium-m"></i> </a>and <a class="icon" target="_blank" rel="noopener" href="mailto:iOliverNguyen@gmail.com"><i class="fas fa-envelope"></i> </a>.</span></p></div></article><div id="header-post"><a id="menu-icon" href="/w"><i class="fas fa-chevron-left fa-lg"></i> <span class="icon-text">Back</span></a> <a id="menu-icon-tablet" href="/w"><i class="fas fa-chevron-left fa-lg"></i> <span class="icon-text">Back</span></a></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul></ul></div><div id="toc-footer" class="tog-footer" style="display:none"><script>console.log("content",'<nav id="TableOfContents">\n  <ul>\n    <li><a href="#what-is-it">What is it?</a></li>\n    <li><a href="#how-to-deal-with-it">How to deal with it?</a></li>\n    <li><a href="#recap">Recap</a></li>\n  </ul>\n</nav>')</script><div class="toc-header"><a href="#">Eventual consistency and cache</a></div><nav id="TableOfContents"><ul><li><a href="#what-is-it">What is it?</a></li><li><a href="#how-to-deal-with-it">How to deal with it?</a></li><li><a href="#recap">Recap</a></li></ul></nav></div><div id="share-footer" class="tog-footer" style="display:none"><ul><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2feventual.consistency%2f&title=Eventual%20consistency%20and%20cache"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fiOliverNguyen.github.io%2fw%2feventual.consistency%2f"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://x.com/share?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2feventual.consistency%2f&text=Eventual%20consistency%20and%20cache"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2feventual.consistency%2f&title=Eventual%20consistency%20and%20cache"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fiOliverNguyen.github.io%2fw%2feventual.consistency%2f&t=Eventual%20consistency%20and%20cache"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="home" class="icon" href="/w"><i class="fas fa-chevron-left fa-lg" aria-hidden="true"></i> Back</a> <a id="toc" class="icon" href="#" onclick='return $(".tog-footer").toggle(),!1'><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a> <a id="share" class="icon" href="#" onclick='return $(".tog-footer").toggle(),!1'><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2024 Oliver Nguyen.</div><div class="footer-right"><nav><ul></ul></nav></div></footer></div></body><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script src="/lib/jquery/jquery.min.js"></script><script src="/js/main.js"></script></html>