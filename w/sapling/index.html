<!doctype html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>My first impressions of Sapling â€” Metaâ€™s new Git client | Oliver Nguyen</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="all,follow"><meta name="googlebot" content="index,follow,snippet,archive"><meta name="og:site_name" content="Oliver Nguyen"><meta property="og:title" content="My first impressions of Sapling â€” Metaâ€™s new Git client"><meta property="og:description" content="Sapling is a new source control system developed by Meta. Recently, it gains the ability to work with GitHub. I&rsquo;m curious about how it works, so I decided to give it a try and end up using it daily on my company&rsquo;s repositories. If you want to try it out, check their documentation here.
Stacked PRs When developing, I usually create a single commit for each PR and stack them together."><meta property="og:type" content="article"><meta property="og:url" content="https://iOliverNguyen.github.io/w/sapling/"><meta property="og:image" content="https://iOliverNguyen.github.io/images/ogx.png"><meta property="article:section" content="w"><meta property="article:published_time" content="2022-12-16T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-16T00:00:00+00:00"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://iOliverNguyen.github.io/images/ogx.png"><meta name="twitter:title" content="My first impressions of Sapling â€” Metaâ€™s new Git client"><meta name="twitter:description" content="Sapling is a new source control system developed by Meta. Recently, it gains the ability to work with GitHub. I&rsquo;m curious about how it works, so I decided to give it a try and end up using it daily on my company&rsquo;s repositories. If you want to try it out, check their documentation here.
Stacked PRs When developing, I usually create a single commit for each PR and stack them together."><link rel="stylesheet" href="https://iOliverNguyen.github.io/css/style-classic.css"><link rel="stylesheet" href="https://iOliverNguyen.github.io/style.css"><link rel="icon" type="image/png" href="/images/favicon.png"><link href="https://iOliverNguyen.github.io/w/sapling/index.xml" rel="alternate" type="application/rss+xml" title="Oliver Nguyen"><script async src="https://www.googletagmanager.com/gtag/js?id=G-L5X8RJDCLM"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-L5X8RJDCLM")</script><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">My first impressions of Sapling â€” Metaâ€™s new Git client</h1><div class="meta"><div class="postdate"><time datetime="2022-12-16 00:00:00 &#43;0000 UTC" itemprop="datePublished">2022-12-16</time></div><div class="article-tag">&nbsp;Â· <a class="tag-link" href="/w/#git" rel="tag">git</a></div><div class="published-at">published at <a target="_blank" href="https://medium.com/better-programming/709eec0ffcb1">Better Programming</a></div></div></header><div class="content" itemprop="articleBody"><p><a href="https://sapling-scm.com/docs/introduction/">Sapling</a> is a new source control system developed by Meta. Recently, it gains the ability to work with GitHub. I&rsquo;m curious about how it works, so I decided to give it a try and end up using it daily on my company&rsquo;s repositories. If you want to try it out, check <a href="https://sapling-scm.com/docs/category/introduction">their documentation here</a>.</p><h2 id="stacked-prs">Stacked PRs</h2><p><img src="stacked.png" alt="stacked-prs"></p><p>When developing, I usually create a single commit for each PR and stack them together.</p><p>To give an example, let&rsquo;s say we are developing the sign-up feature: user inputs their email address, password, and we send them a nice welcome email. From the backend perspective, we need to create a new user, verify that the user doesn&rsquo;t exist, and send the email. We need to touch the implementation of the cache package, add an email package, then finally implement the sign-up logic. This can be represented as a stack of PRs:</p><ol><li>Update the cache package to add a new method.</li><li>Add the email sending system. It uses the cache package to prevent sending duplicated emails.</li><li>Implement the sign-up logic. It depends on the two changes above.</li></ol><p><em>The benefit</em>: This help reviewers with separation of concern. Smaller, isolated changes are easier to be reviewed. They can check the PRs one by one, with each PR containing independent logic. Of course, the email system still requires the cache package to be updated, but we can still review the email system in isolation.</p><p>When the origin gets updated, we&rsquo;ll pull the changes and rebase the PRs on top of the origin, push the changes, get reviewed, and merge.</p><p><em>The downside:</em> It requires discipline to keep the PRs small and isolated. Usually, while developing the upper PRs, we need to make some changes in the lower PRs. This can be annoying since we have to keep track of what changes in what PR, or constantly switch between PRs to make changes, then rebase the upper ones.</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">git checkout mybranch/signup   <span class="c1"># checkout sign up branch</span>
vim features/signup/signup.go  <span class="c1"># make changes to signup</span>
vim lib/email/email.go         <span class="c1"># make changes to email package</span>

git add features/signup        <span class="c1"># commit the signup changes        </span>
git commit --amend             

git stash                      <span class="c1"># stash the email changes</span>
git checkout mybranch/email    <span class="c1"># checkout email branch</span>
git stash pop                  <span class="c1"># apply the email changes</span>
git add lib/email              <span class="c1"># commit the email changes</span>
git commit --amend

git checkout mybranch/signup   <span class="c1"># checkout sign up branch again</span>
git rebase mybranch/email      <span class="c1"># rebase the signup branch on top of email branch</span>
</code></pre></div><p>Too much switching, and too many commands to type. It&rsquo;s not fun.</p><h2 id="enter-sapling">Enter sapling</h2><p>Sapling is a new git client. It encourages the use of stacked PR. It will automatically rebase the PRs on top of each other, so we don&rsquo;t have to do it manually.</p><p>Given the following commit structure, presented by calling the <code>sl</code> command:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sl
  @  00f1749f6  <span class="m">30</span> minutes ago  oliver
  â”‚  implement user signup
  â”‚
  @  e0dbbc80e  <span class="m">50</span> minutes ago  oliver
  â”‚  implement email package
  â”‚
  o  4f6928029  Yesterday at   oliver
â•­â”€â•¯  update cache package
â”‚
o  876f46044  Today at 07:45  remote/main
</code></pre></div><p>The workflow with sapling will be:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sl goto 00f1749f6              <span class="c1"># checkout the sign up code</span>
vim features/signup/signup.go  <span class="c1"># make changes to signup</span>
vim lib/email/email.go         <span class="c1"># make changes to email package</span>

sl absorb                      <span class="c1"># magic ðŸ‘»</span>
</code></pre></div><p>With only a single command <code>sl absorb</code>, sapling will:</p><ul><li>Amend the <code>email.go</code> changes to the signup commit.</li><li>Amend the <code>signup.go</code> changes to the signup commit.</li><li>Rebase the signup commit on top of the email commit.</li></ul><p>Your changes will be absorbed into the PRs, and the PRs will be rebased on top of each other. You don&rsquo;t have to do it manually as before. With only a single command. Well done! ðŸ‘»</p><h2 id="my-experience-with-sapling">My experience with sapling</h2><p>The first problem comes from our use of <a href="https://direnv.net">direnv</a>. We use <code>git rev-parse --show-toplevel</code> to get the root of our repository. And of course, it won&rsquo;t work with sapling. Read more about it in my post: <a href="../sapling.direnv.md">Make sapling work with direnv</a>. Some other issues including IDE and GUI won&rsquo;t work with sapling (yet). But I&rsquo;m getting used to it quickly.</p><p>So I&rsquo;m using sapling for a few weeks now. And the overall experience is great.</p><h3 id="commonly-used-commands">Commonly used commands</h3><p>View repository status:</p><ul><li><code>sl</code>: show the commit-graph (or smart-log)</li><li><code>sl status</code>: show the status of the current branch</li></ul><p>Moving between commits:</p><ul><li><code>sl goto &lt;commit&gt;</code>: checkout the commit.</li><li><code>sl next</code>, <code>sl prev</code>: checkout the next/previous commit.</li></ul><p>Working with commits:</p><ul><li><code>sl add</code>, <code>sl remove</code>, <code>sl forget</code>: add/remove/untrack files.</li><li><code>sl commit</code>: commit the changes as a new commit.</li><li><code>sl metaedit</code>: edit the commit message.</li><li><code>sl absorb</code>: absorb the changes into the PRs, and rebase the PRs on top of each other.</li><li><code>sl rebase</code>: rebase the PRs on top of each other.</li></ul><p>While <code>git add</code> adds all changes to the staging area, including new files, deleted files; the corresponding command <code>sl add</code> will only add new files to the staging area. To remove files, we must use <code>sl remove</code>. This will be a bit annoying when committing vendor files, since we have to list all deleted files to remove them. I&rsquo;m not sure if there is a better way:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ sl status
? vendor/github.com/sample/cache/v2/caching.go
? vendor/github.com/sample/cache/v2/stripe.go
! vendor/github.com/sample/cache/v2/deprecated.go
! vendor/github.com/sample/cache/v2/formatter.go

$ sl add vendor
A vendor/github.com/sample/cache/v2/caching.go
A vendor/github.com/sample/cache/v2/stripe.go
! vendor/github.com/sample/cache/v2/deprecated.go
! vendor/github.com/sample/cache/v2/formatter.go

<span class="c1"># Have to list all deleted files to remove, is there a better way? ðŸ˜ž</span>
$ sl remove vendor/github.com/sample/cache/v2/deprecated.go <span class="se">\
</span><span class="se"></span>            vendor/github.com/sample/cache/v2/formatter.go
            
A vendor/github.com/sample/cache/v2/caching.go
A vendor/github.com/sample/cache/v2/stripe.go
R vendor/github.com/sample/cache/v2/deprecated.go
R vendor/github.com/sample/cache/v2/formatter.go           
</code></pre></div><p>We can not use <code>sl remove vendor/github.com/sample/cache/v2</code> here because it will happily remove all new/changed files too. I have to list all removed files to remove them from sapling.</p><h3 id="pushing-prs-to-github">Pushing PRs to GitHub</h3><p>Sapling provides 2 ways of pushing PRs to GitHub: <code>sl pr</code> and <code>sl ghstack</code>. Each has different trade-offs. I prefer using the <code>sl pr</code> command:</p><ul><li>It creates a PR for each commit.</li><li>It pushes the PRs to GitHub in the order of the commits.</li><li>It&rsquo;s easier to understand as commits stacks nicely on each other.</li><li>It works well and can be reviewed with GitHub&rsquo;s UI.</li><li>Another benefit, it does not require write permission to the repository, in case you are doing a fork.</li></ul><p>The <code>sl ghstack</code> command creates a more complex web of PRs. And there are a lot of times when it fails to push the PRs. Try again won&rsquo;t work. No available fixes. Have to duplicate these PRs again and risk spamming my company repositories. I don&rsquo;t recommend it.</p><h3 id="reviewing-prs">Reviewing PRs</h3><p><img src="review.png" alt="review.png"></p><p>Sapling recommends using <a href="https://reviewstack.dev">reviewstack</a> for reviewing. But I find it slow, less responsive, and sometimes gives wrong file changes. I prefer using GitHub&rsquo;s UI. When pushing PRs with <code>sl pr</code>, it creates a single commit for each PR. So the reviewer can open the latest commit, and review the changes. Just one more extra click compared to the usual review flow:</p><ul><li>Go to Commits tab.</li><li>Choose the latest commit.</li><li>Review and add comments. These comments will appear on the PR as usual.</li></ul><h3 id="other-things">Other things</h3><p>It requires cloning a new repository, so you can&rsquo;t use your familiar git commands. It won&rsquo;t work with your existing tools, IDE, etc. You have to use the <code>sl web</code> UI to view changes.</p><h2 id="give-it-a-try">Give it a try!</h2><p>Sapling is great. While there are a few troubles, and it requires a small learning curve, it pays back in the end. Stacking, pushing and reviewing PRs is much easier. Give it a try!</p><h2 id="author">Author</h2><p>I'm Oliver Nguyen. A software maker working mostly in Go and JavaScript. I enjoy learning and seeing a better version of myself each day. Occasionally spin off new open source projects. Share knowledge and thoughts during my journey. <span>Connect with me on <a class="icon" target="_blank" rel="noopener" href="https://github.com/iOliverNguyen"><i class="fab fa-github"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://linkedin.com/in/iOliverNguyen"><i class="fab fa-linkedin"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://x.com/_OliverNguyen"><i class="fab fa-twitter"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://iOliverNguyen.medium.com"><i class="fab fa-medium-m"></i> </a>and <a class="icon" target="_blank" rel="noopener" href="mailto:iOliverNguyen@gmail.com"><i class="fas fa-envelope"></i> </a>.</span></p></div></article><div id="header-post"><a id="menu-icon" href="/w"><i class="fas fa-chevron-left fa-lg"></i> <span class="icon-text">Back</span></a> <a id="menu-icon-tablet" href="/w"><i class="fas fa-chevron-left fa-lg"></i> <span class="icon-text">Back</span></a></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul></ul></div><div id="toc-footer" class="tog-footer" style="display:none"><script>console.log("content",'<nav id="TableOfContents">\n  <ul>\n    <li><a href="#stacked-prs">Stacked PRs</a></li>\n    <li><a href="#enter-sapling">Enter sapling</a></li>\n    <li><a href="#my-experience-with-sapling">My experience with sapling</a>\n      <ul>\n        <li><a href="#commonly-used-commands">Commonly used commands</a></li>\n        <li><a href="#pushing-prs-to-github">Pushing PRs to GitHub</a></li>\n        <li><a href="#reviewing-prs">Reviewing PRs</a></li>\n        <li><a href="#other-things">Other things</a></li>\n      </ul>\n    </li>\n    <li><a href="#give-it-a-try">Give it a try!</a></li>\n  </ul>\n</nav>')</script><div class="toc-header"><a href="#">My first impressions of Sapling â€” Metaâ€™s new Git client</a></div><nav id="TableOfContents"><ul><li><a href="#stacked-prs">Stacked PRs</a></li><li><a href="#enter-sapling">Enter sapling</a></li><li><a href="#my-experience-with-sapling">My experience with sapling</a><ul><li><a href="#commonly-used-commands">Commonly used commands</a></li><li><a href="#pushing-prs-to-github">Pushing PRs to GitHub</a></li><li><a href="#reviewing-prs">Reviewing PRs</a></li><li><a href="#other-things">Other things</a></li></ul></li><li><a href="#give-it-a-try">Give it a try!</a></li></ul></nav></div><div id="share-footer" class="tog-footer" style="display:none"><ul><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fsapling%2f&title=My%20first%20impressions%20of%20Sapling%20%e2%80%94%20Meta%e2%80%99s%20new%20Git%20client"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fsapling%2f"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://x.com/share?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fsapling%2f&text=My%20first%20impressions%20of%20Sapling%20%e2%80%94%20Meta%e2%80%99s%20new%20Git%20client"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fsapling%2f&title=My%20first%20impressions%20of%20Sapling%20%e2%80%94%20Meta%e2%80%99s%20new%20Git%20client"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fsapling%2f&t=My%20first%20impressions%20of%20Sapling%20%e2%80%94%20Meta%e2%80%99s%20new%20Git%20client"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="home" class="icon" href="/w"><i class="fas fa-chevron-left fa-lg" aria-hidden="true"></i> Back</a> <a id="toc" class="icon" href="#" onclick='return $(".tog-footer").toggle(),!1'><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a> <a id="share" class="icon" href="#" onclick='return $(".tog-footer").toggle(),!1'><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2024 Oliver Nguyen.</div><div class="footer-right"><nav><ul></ul></nav></div></footer></div></body><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script src="/lib/jquery/jquery.min.js"></script><script src="/js/main.js"></script></html>