<!doctype html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Refactor: GoroutineTracker with unnecessary usage of reflect | Oliver Nguyen</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="all,follow"><meta name="googlebot" content="index,follow,snippet,archive"><meta name="og:site_name" content="Oliver Nguyen"><meta property="og:title" content="Refactor: GoroutineTracker with unnecessary usage of reflect"><meta property="og:description" content="Today, I encountered this code in my company codebase (the code and comments are rewritten for demo purpose and do not include any proprietary code):
type GoroutineTracker struct { wg sync.WaitGroup // ... some other fields } // Go starts a new goroutine and tracks it with some metrics. func (g *GoroutineTracker) Go(ctx context.Context, name string, f any, args ...any) { fn := reflect.TypeOf(f) if fn.Kind() != reflect.Func { panic(&#34;must be function&#34;) } if fn."><meta property="og:type" content="article"><meta property="og:url" content="https://iOliverNguyen.github.io/w/go.tracker/"><meta property="og:image" content="https://iOliverNguyen.github.io/images/ogx.png"><meta property="article:section" content="w"><meta property="article:published_time" content="2024-07-02T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-02T00:00:00+00:00"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://iOliverNguyen.github.io/images/ogx.png"><meta name="twitter:title" content="Refactor: GoroutineTracker with unnecessary usage of reflect"><meta name="twitter:description" content="Today, I encountered this code in my company codebase (the code and comments are rewritten for demo purpose and do not include any proprietary code):
type GoroutineTracker struct { wg sync.WaitGroup // ... some other fields } // Go starts a new goroutine and tracks it with some metrics. func (g *GoroutineTracker) Go(ctx context.Context, name string, f any, args ...any) { fn := reflect.TypeOf(f) if fn.Kind() != reflect.Func { panic(&#34;must be function&#34;) } if fn."><link rel="stylesheet" href="https://iOliverNguyen.github.io/css/style-classic.css"><link rel="stylesheet" href="https://iOliverNguyen.github.io/style.css"><link rel="icon" type="image/png" href="/images/favicon.png"><link href="https://iOliverNguyen.github.io/w/go.tracker/index.xml" rel="alternate" type="application/rss+xml" title="Oliver Nguyen"><script async src="https://www.googletagmanager.com/gtag/js?id=G-L5X8RJDCLM"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-L5X8RJDCLM")</script><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Refactor: GoroutineTracker with unnecessary usage of reflect</h1><div class="meta"><div class="postdate"><time datetime="2024-07-02 00:00:00 &#43;0000 UTC" itemprop="datePublished">2024-07-02</time></div><div class="article-tag">&nbsp;Â· <a class="tag-link" href="/w/#go" rel="tag">go</a></div></div></header><div class="content" itemprop="articleBody"><p>Today, I encountered this code in my company codebase <em>(the code and comments are rewritten for demo purpose and do not include any proprietary code)</em>:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">GoroutineTracker</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
  <span class="c1">// ... some other fields
</span><span class="c1"></span><span class="p">}</span>
<span class="c1">// Go starts a new goroutine and tracks it with some metrics.
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">GoroutineTracker</span><span class="p">)</span> <span class="nf">Go</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">f</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">fn</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">TypeOf</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">fn</span><span class="p">.</span><span class="nf">Kind</span><span class="p">()</span> <span class="o">!=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">Func</span> <span class="p">{</span> <span class="nb">panic</span><span class="p">(</span><span class="s">&#34;must be function&#34;</span><span class="p">)</span> <span class="p">}</span>
	<span class="k">if</span> <span class="nx">fn</span><span class="p">.</span><span class="nf">NumIn</span><span class="p">()</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span> <span class="nb">panic</span><span class="p">(</span><span class="s">&#34;args does not match fn signature&#34;</span><span class="p">)</span> <span class="p">}</span>
	<span class="k">if</span> <span class="nx">fn</span><span class="p">.</span><span class="nf">NumOut</span><span class="p">()</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span> <span class="nb">panic</span><span class="p">(</span><span class="s">&#34;output from fn is ignored&#34;</span><span class="p">)</span> <span class="p">}</span>
	
	<span class="nx">g</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="nx">id</span> <span class="o">:=</span> <span class="nx">g</span><span class="p">.</span><span class="nf">startCaptureTime</span><span class="p">()</span>
	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">r</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">()</span>
			<span class="c1">// ... some panic handling code
</span><span class="c1"></span>			<span class="nx">g</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
			<span class="nx">g</span><span class="p">.</span><span class="nf">endCaptureTime</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
		<span class="p">}()</span>
		
		<span class="nx">input</span> <span class="o">:=</span> <span class="nx">typez</span><span class="p">.</span><span class="nf">MapFunc</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">arg</span> <span class="nx">any</span><span class="p">)</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">Value</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">ValueOf</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span>
		<span class="p">})</span>
		<span class="nx">_</span> <span class="p">=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">ValueOf</span><span class="p">(</span><span class="nx">f</span><span class="p">).</span><span class="nf">Call</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
	<span class="p">}()</span>
<span class="p">}</span>
<span class="c1">// Wait for all goroutines to finished.
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">GoroutineTracker</span><span class="p">)</span> <span class="nf">Wait</span><span class="p">()</span> <span class="p">{</span> <span class="nx">g</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span> <span class="p">}</span>
</code></pre></div><p>The <code>GoroutineTracker</code> is used for tracking usage of goroutines in the codebase, for example, number of goroutines, time taken by each goroutine, etc. The <code>Go</code> method is used to start a new goroutine and track it. The <code>Wait</code> method is used to wait for all goroutines to finish.</p><p>Example of usage:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">g</span> <span class="o">:=</span> <span class="nf">NewGoroutineTracker</span><span class="p">()</span>
<span class="nx">g</span><span class="p">.</span><span class="nf">Go</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;task1&#34;</span><span class="p">,</span> <span class="nx">doTask1</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span>
<span class="nx">g</span><span class="p">.</span><span class="nf">Go</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;task2&#34;</span><span class="p">,</span> <span class="nx">doTask2</span><span class="p">,</span> <span class="nx">arg3</span><span class="p">)</span>
<span class="nx">g</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</code></pre></div><h2 id="problem-the-usage-of-reflect-is-unnecessary-and-can-be-avoided">Problem: The usage of reflect is unnecessary and can be avoided</h2><p>Well, that code works, but it uses the <a href="https://pkg.go.dev/reflect">reflect</a> package to check the function signature then call the function. It&rsquo;s totally unnecessary, and we can avoid it by changing the usage to:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">g</span> <span class="o">:=</span> <span class="nf">NewGoroutineTracker</span><span class="p">()</span>
<span class="nx">g</span><span class="p">.</span><span class="nf">Go</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;task1&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nf">doTask1</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">g</span><span class="p">.</span><span class="nf">Go</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;task2&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nf">doTask2</span><span class="p">(</span><span class="nx">arg3</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div><p>The new code will be simpler and has many benefits:</p><ul><li><strong>Type safety</strong>: No need to check the function signature using reflect. The compiler will do it for us. The original code has potential runtime errors if the function signature does not match the arguments.</li><li><strong>Error handling</strong>: We can return an error from the function and handle it in the caller. The original code ignores the output of the function.</li><li><strong>Readability</strong>: The new code is more readable and easier to understand. We can see the function signature and arguments directly in the code.</li></ul><h2 id="a-better-implementation-of-goroutinetracker">A better implementation of GoroutineTracker</h2><p>Here is the refactored code:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">GoroutineTracker</span><span class="p">)</span> <span class="nf">Go</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">fn</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">g</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="nx">id</span> <span class="o">:=</span> <span class="nx">g</span><span class="p">.</span><span class="nf">startCaptureTime</span><span class="p">()</span>
	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">r</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">()</span>
			<span class="c1">// capture returned error and panic
</span><span class="c1"></span>			<span class="nx">g</span><span class="p">.</span><span class="nf">endCaptureTime</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
			<span class="nx">g</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
		<span class="p">}()</span>
		<span class="c1">// just call the function, no reflect needed
</span><span class="c1"></span>		<span class="k">return</span> <span class="nf">fn</span><span class="p">()</span>
	<span class="p">}()</span>
<span class="p">}</span>
</code></pre></div><h2 id="wait-for-all-goroutines-to-finish-before-shutting-down">Wait for all goroutines to finish before shutting down</h2><p>Another use case for <code>GoroutineTracker</code> is for waiting all goroutines to finish before shutting down the application. So we can have 2 types of waiting:</p><ul><li><strong>In a function</strong>: Waiting for all local goroutines to finish.</li><li><strong>When application shutdown</strong>: Waiting for all goroutines that started by any <code>GoroutineTracker</code> to finish.</li></ul><p>We can implement it by adding a global tracker and making any tracker register its function to the global tracker:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">GlobalTracker</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
	<span class="c1">// ... some other fields
</span><span class="c1"></span><span class="p">}</span>
<span class="kd">type</span> <span class="nx">GoroutineTracker</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">parent</span> <span class="o">*</span><span class="nx">GlobalTracker</span>
	<span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
	<span class="c1">// ... some other fields
</span><span class="c1"></span><span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">GlobalTracker</span><span class="p">)</span> <span class="nf">New</span><span class="p">()</span> <span class="o">*</span><span class="nx">GoroutineTracker</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">GoroutineTracker</span><span class="p">{</span><span class="nx">parent</span><span class="p">:</span> <span class="nx">g</span><span class="p">}</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">GoroutineTracker</span><span class="p">)</span> <span class="nf">Go</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">fn</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">g</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="c1">// use both parent and local wg
</span><span class="c1"></span>	<span class="nx">g</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>     <span class="c1">//   to track the new goroutine
</span><span class="c1"></span>	<span class="nx">id</span> <span class="o">:=</span> <span class="nx">g</span><span class="p">.</span><span class="nf">startCaptureTime</span><span class="p">()</span>
	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
			<span class="c1">// ...
</span><span class="c1"></span>			<span class="nx">g</span><span class="p">.</span><span class="nf">endCaptureTime</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
			<span class="nx">g</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
			<span class="nx">g</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
		<span class="p">}()</span>
		
		<span class="k">return</span> <span class="nf">fn</span><span class="p">()</span>
	<span class="p">}()</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">GlobalTracker</span><span class="p">)</span> <span class="nf">WaitForAll</span><span class="p">()</span> <span class="p">{</span> <span class="nx">g</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span> <span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">GoroutineTracker</span><span class="p">)</span> <span class="nf">Wait</span><span class="p">()</span>    <span class="p">{</span> <span class="nx">g</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span> <span class="p">}</span>
</code></pre></div><p>And we can use <code>WaitForAll()</code> to wait for all goroutines to finish before shutting down the application:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">FooService</span> <span class="p">{</span>
	<span class="nx">tracker</span> <span class="o">*</span><span class="nx">GlobalTracker</span>
	<span class="c1">// ... some other fields
</span><span class="c1"></span><span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">FooService</span><span class="p">)</span> <span class="nf">DoSomething</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">g</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">tracker</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
	<span class="nx">g</span><span class="p">.</span><span class="nf">Go</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nf">doTask1</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span> <span class="p">})</span>
	<span class="nx">g</span><span class="p">.</span><span class="nf">Go</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nf">doTask2</span><span class="p">(</span><span class="nx">arg3</span><span class="p">)</span> <span class="p">})</span>
	<span class="nx">g</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>     <span class="c1">// wait for local goroutines, this is optional
</span><span class="c1"></span><span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="c1">// some initialization, then start the application
</span><span class="c1"></span>	<span class="nx">globalTracker</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">GlobalTracker</span><span class="p">{}</span>
	<span class="nx">fooService</span> <span class="o">:=</span> <span class="nx">FooService</span><span class="p">{</span><span class="nx">tracker</span><span class="p">:</span> <span class="nx">globalTracker</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">}</span>
	<span class="nx">application</span><span class="p">.</span><span class="nf">Start</span><span class="p">()</span>
	
	<span class="c1">// wait for all goroutines to finish before shutting down
</span><span class="c1"></span>	<span class="o">&lt;-</span><span class="nx">application</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
	<span class="nx">globalTracker</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div><h2 id="conclusion">Conclusion</h2><p>In conclusion, while the original implementation of <code>GoroutineTracker</code> works and can track goroutines, its use of the <a href="https://pkg.go.dev/reflect">reflect</a> package to dynamically check and call functions introduces unnecessary complexity and potential runtime errors. By refactoring the code to directly accept function literals, we achieve improved type safety, streamlined error handling, and enhanced readability. This approach leverages Go&rsquo;s compiler-checked type system to ensure compatibility between function signatures and arguments, resulting in more robust and maintainable code. By adopting these changes, we optimize the <code>GoroutineTracker</code> for clarity and reliability, aligning with best practices in Go programming.</p><h2 id="author">Author</h2><p>I'm Oliver Nguyen. A software maker working mostly in Go and JavaScript. I enjoy learning and seeing a better version of myself each day. Occasionally spin off new open source projects. Share knowledge and thoughts during my journey. <span>Connect with me on <a class="icon" target="_blank" rel="noopener" href="https://github.com/iOliverNguyen"><i class="fab fa-github"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://linkedin.com/in/iOliverNguyen"><i class="fab fa-linkedin"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://x.com/_OliverNguyen"><i class="fab fa-twitter"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://iOliverNguyen.medium.com"><i class="fab fa-medium-m"></i> </a>and <a class="icon" target="_blank" rel="noopener" href="mailto:iOliverNguyen@gmail.com"><i class="fas fa-envelope"></i> </a>.</span></p></div></article><div id="header-post"><a id="menu-icon" href="/w"><i class="fas fa-chevron-left fa-lg"></i> <span class="icon-text">Back</span></a> <a id="menu-icon-tablet" href="/w"><i class="fas fa-chevron-left fa-lg"></i> <span class="icon-text">Back</span></a></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul></ul></div><div id="toc-footer" class="tog-footer" style="display:none"><script>console.log("content",'<nav id="TableOfContents">\n  <ul>\n    <li><a href="#problem-the-usage-of-reflect-is-unnecessary-and-can-be-avoided">Problem: The usage of reflect is unnecessary and can be avoided</a></li>\n    <li><a href="#a-better-implementation-of-goroutinetracker">A better implementation of GoroutineTracker</a></li>\n    <li><a href="#wait-for-all-goroutines-to-finish-before-shutting-down">Wait for all goroutines to finish before shutting down</a></li>\n    <li><a href="#conclusion">Conclusion</a></li>\n  </ul>\n</nav>')</script><div class="toc-header"><a href="#">Refactor: GoroutineTracker with unnecessary usage of reflect</a></div><nav id="TableOfContents"><ul><li><a href="#problem-the-usage-of-reflect-is-unnecessary-and-can-be-avoided">Problem: The usage of reflect is unnecessary and can be avoided</a></li><li><a href="#a-better-implementation-of-goroutinetracker">A better implementation of GoroutineTracker</a></li><li><a href="#wait-for-all-goroutines-to-finish-before-shutting-down">Wait for all goroutines to finish before shutting down</a></li><li><a href="#conclusion">Conclusion</a></li></ul></nav></div><div id="share-footer" class="tog-footer" style="display:none"><ul><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fgo.tracker%2f&title=Refactor%3a%20GoroutineTracker%20with%20unnecessary%20usage%20of%20reflect"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fgo.tracker%2f"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://x.com/share?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fgo.tracker%2f&text=Refactor%3a%20GoroutineTracker%20with%20unnecessary%20usage%20of%20reflect"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fgo.tracker%2f&title=Refactor%3a%20GoroutineTracker%20with%20unnecessary%20usage%20of%20reflect"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fgo.tracker%2f&t=Refactor%3a%20GoroutineTracker%20with%20unnecessary%20usage%20of%20reflect"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="home" class="icon" href="/w"><i class="fas fa-chevron-left fa-lg" aria-hidden="true"></i> Back</a> <a id="toc" class="icon" href="#" onclick='return $(".tog-footer").toggle(),!1'><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a> <a id="share" class="icon" href="#" onclick='return $(".tog-footer").toggle(),!1'><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2024 Oliver Nguyen.</div><div class="footer-right"><nav><ul></ul></nav></div></footer></div></body><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script src="/lib/jquery/jquery.min.js"></script><script src="/js/main.js"></script></html>