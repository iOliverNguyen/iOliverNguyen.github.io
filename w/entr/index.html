<!doctype html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>TIL: Auto-reload a command when files changed using entr | Oliver Nguyen</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="all,follow"><meta name="googlebot" content="index,follow,snippet,archive"><meta name="og:site_name" content="Oliver Nguyen"><meta property="og:title" content="TIL: Auto-reload a command when files changed using entr"><meta property="og:description" content="While working with Go and JavaScript, we have tools available for auto reloading the server when the code changes. For JavaScript, we even have hot reload which reloads part of the page without reloading the whole page. But for Python, we don&rsquo;t have such tools, I tried livereload, but it does not work well for nested directories. So I decided to do it myself. And there is a tool called entr which helps run a command when some file changes."><meta property="og:type" content="article"><meta property="og:url" content="https://iOliverNguyen.github.io/w/entr/"><meta property="og:image" content="https://iOliverNguyen.github.io/images/ogx.png"><meta property="article:section" content="w"><meta property="article:published_time" content="2023-05-15T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-15T00:00:00+00:00"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://iOliverNguyen.github.io/images/ogx.png"><meta name="twitter:title" content="TIL: Auto-reload a command when files changed using entr"><meta name="twitter:description" content="While working with Go and JavaScript, we have tools available for auto reloading the server when the code changes. For JavaScript, we even have hot reload which reloads part of the page without reloading the whole page. But for Python, we don&rsquo;t have such tools, I tried livereload, but it does not work well for nested directories. So I decided to do it myself. And there is a tool called entr which helps run a command when some file changes."><link rel="stylesheet" href="https://iOliverNguyen.github.io/css/style-classic.css"><link rel="stylesheet" href="https://iOliverNguyen.github.io/style.css"><link rel="icon" type="image/png" href="/images/favicon.png"><link href="https://iOliverNguyen.github.io/w/entr/index.xml" rel="alternate" type="application/rss+xml" title="Oliver Nguyen"><script async src="https://www.googletagmanager.com/gtag/js?id=G-L5X8RJDCLM"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-L5X8RJDCLM")</script><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">TIL: Auto-reload a command when files changed using entr</h1><div class="meta"><div class="postdate"><time datetime="2023-05-15 00:00:00 &#43;0000 UTC" itemprop="datePublished">2023-05-15</time></div><div class="article-tag">&nbsp;Â· <a class="tag-link" href="/w/#linux" rel="tag">linux</a></div></div></header><div class="content" itemprop="articleBody"><p>While working with Go and JavaScript, we have tools available for auto reloading the server when the code changes. For JavaScript, we even have hot reload which reloads part of the page without reloading the whole page. But for Python, we don&rsquo;t have such tools, I tried livereload, but it does not work well for nested directories. So I decided to do it myself. And there is a tool called <a href="https://github.com/eradman/entr"><code>entr</code></a> which helps run a command when some file changes.</p><p>First, install <code>entr</code>:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">apt get entr
</code></pre></div><p>It can be used like this, which will run <code>python main.py</code> when any file in the current directory changes, recursively:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">find . <span class="p">|</span> entr -r python main.py
</code></pre></div><p>But this will only work for changes in existing files, not for new files. To fix this, we can combine with some tricks. Let&rsquo;s use <code>ls -alR | sha256sum</code> to get a hash of all files in the current directory recursively. And then we can compare the hash to see if any file has changed:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">hash<span class="o">()</span> <span class="o">{</span>
  ls -alR <span class="p">|</span> sha256sum
<span class="o">}</span>

<span class="nv">hash0</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span><span class="nb">hash</span><span class="k">)</span><span class="s2">&#34;</span>
<span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$hash0</span><span class="s2">&#34;</span> &gt; /tmp/hash.txt
<span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
  <span class="nv">hash1</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span><span class="nb">hash</span><span class="k">)</span><span class="s2">&#34;</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="s2">&#34;</span><span class="nv">$hash0</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$hash1</span><span class="s2">&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">hash0</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$hash1</span><span class="s2">&#34;</span>
    <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$hash1</span><span class="s2">&#34;</span> &gt; /tmp/hash.txt
  <span class="k">fi</span>
<span class="k">done</span>
</code></pre></div><p>Here is the final code, enjoy!</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span>
hash<span class="o">()</span> <span class="o">{</span>
  ls -alR <span class="p">|</span> grep <span class="s1">&#39;\.py$&#39;</span> <span class="p">|</span> sha256sum
<span class="o">}</span>

watch<span class="o">()</span> <span class="o">{</span>
  <span class="nv">hash0</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>cat /tmp/hash.txt<span class="k">)</span><span class="s2">&#34;</span>
  <span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
    <span class="nv">hash1</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span><span class="nb">hash</span><span class="k">)</span><span class="s2">&#34;</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="s2">&#34;</span><span class="nv">$hash0</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$hash1</span><span class="s2">&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
      <span class="nb">printf</span> <span class="s2">&#34;\n\n------- restarting server -------\n\n&#34;</span>
      <span class="nv">hash0</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$hash1</span><span class="s2">&#34;</span>
      <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$hash1</span><span class="s2">&#34;</span> &gt; /tmp/hash.txt
    <span class="k">fi</span>
    sleep <span class="m">2</span>
  <span class="k">done</span>
<span class="o">}</span>

<span class="k">if</span> <span class="o">[[</span> -z <span class="s2">&#34;</span><span class="nv">$DEBUG</span><span class="s2">&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&#34;</span><span class="k">$(</span><span class="nb">hash</span><span class="k">)</span><span class="s2">&#34;</span> &gt; /tmp/hash.txt
    watch <span class="p">&amp;</span>
    <span class="nb">echo</span> <span class="s1">&#39;/tmp/hash.txt&#39;</span> <span class="p">|</span> entr -r python apps/rpc/app/main.py
<span class="k">else</span>
    python -m debugpy --listen 0.0.0.0:12345 apps/rpc/app/main.py
<span class="k">fi</span>
</code></pre></div><h2 id="author">Author</h2><p>I'm Oliver Nguyen. A software maker working mostly in Go and JavaScript. I enjoy learning and seeing a better version of myself each day. Occasionally spin off new open source projects. Share knowledge and thoughts during my journey. <span>Connect with me on <a class="icon" target="_blank" rel="noopener" href="https://github.com/iOliverNguyen"><i class="fab fa-github"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://linkedin.com/in/iOliverNguyen"><i class="fab fa-linkedin"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://x.com/_OliverNguyen"><i class="fab fa-twitter"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://iOliverNguyen.medium.com"><i class="fab fa-medium-m"></i> </a>and <a class="icon" target="_blank" rel="noopener" href="mailto:iOliverNguyen@gmail.com"><i class="fas fa-envelope"></i> </a>.</span></p></div></article><div id="header-post"><a id="menu-icon" href="/w"><i class="fas fa-chevron-left fa-lg"></i> <span class="icon-text">Back</span></a> <a id="menu-icon-tablet" href="/w"><i class="fas fa-chevron-left fa-lg"></i> <span class="icon-text">Back</span></a></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul></ul></div><div id="toc-footer" class="tog-footer" style="display:none"><script>console.log("content",'<nav id="TableOfContents"></nav>')</script><div class="toc-header"><a href="#">TIL: Auto-reload a command when files changed using entr</a></div><nav id="TableOfContents"></nav></div><div id="share-footer" class="tog-footer" style="display:none"><ul><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fentr%2f&title=TIL%3a%20Auto-reload%20a%20command%20when%20files%20changed%20using%20entr"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fentr%2f"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://x.com/share?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fentr%2f&text=TIL%3a%20Auto-reload%20a%20command%20when%20files%20changed%20using%20entr"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fentr%2f&title=TIL%3a%20Auto-reload%20a%20command%20when%20files%20changed%20using%20entr"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fentr%2f&t=TIL%3a%20Auto-reload%20a%20command%20when%20files%20changed%20using%20entr"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="home" class="icon" href="/w"><i class="fas fa-chevron-left fa-lg" aria-hidden="true"></i> Back</a> <a id="toc" class="icon" href="#" onclick='return $(".tog-footer").toggle(),!1'><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a> <a id="share" class="icon" href="#" onclick='return $(".tog-footer").toggle(),!1'><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2024 Oliver Nguyen.</div><div class="footer-right"><nav><ul></ul></nav></div></footer></div></body><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script src="/lib/jquery/jquery.min.js"></script><script src="/js/main.js"></script></html>