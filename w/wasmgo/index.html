<!doctype html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>TIL: WASM with Go and run it inside browser | Oliver Nguyen</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="all,follow"><meta name="googlebot" content="index,follow,snippet,archive"><meta name="og:site_name" content="Oliver Nguyen"><meta property="og:title" content="TIL: WASM with Go and run it inside browser"><meta property="og:description" content="const go = new Go(); WebAssembly.instantiateStreaming(fetch(&#34;go/uuid.wasm&#34;), go.importObject).then((result) = { go.run(result.instance); });   Number of UUIDs:   &nbsp;     const form$ = document.querySelector(&#39;#box1 form&#39;); const input$ = document.querySelector(&#39;#box1 .input&#39;); const output$ = document.querySelector(&#39;#box1 .output&#39;); console.log(&#39;xx&#39;) form$.addEventListener(&#39;submit&#39;, (e) = { e.preventDefault(); console.log(&#39;xx&#39;) let output = wasmGenerateUUIDs(input$.value) || &#39;&nbsp;&#39;; output = output.replaceAll(&#39;\n&#39;, &#39;
&#39;); output$.innerHTML = output; })  Enter 1-10 in the above box. It should output UUIDs."><meta property="og:type" content="article"><meta property="og:url" content="https://iOliverNguyen.github.io/w/wasmgo/"><meta property="og:image" content="https://iOliverNguyen.github.io/images/ogx.png"><meta property="article:section" content="w"><meta property="article:published_time" content="2022-06-14T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-14T00:00:00+00:00"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://iOliverNguyen.github.io/images/ogx.png"><meta name="twitter:title" content="TIL: WASM with Go and run it inside browser"><meta name="twitter:description" content="const go = new Go(); WebAssembly.instantiateStreaming(fetch(&#34;go/uuid.wasm&#34;), go.importObject).then((result) = { go.run(result.instance); });   Number of UUIDs:   &nbsp;     const form$ = document.querySelector(&#39;#box1 form&#39;); const input$ = document.querySelector(&#39;#box1 .input&#39;); const output$ = document.querySelector(&#39;#box1 .output&#39;); console.log(&#39;xx&#39;) form$.addEventListener(&#39;submit&#39;, (e) = { e.preventDefault(); console.log(&#39;xx&#39;) let output = wasmGenerateUUIDs(input$.value) || &#39;&nbsp;&#39;; output = output.replaceAll(&#39;\n&#39;, &#39;
&#39;); output$.innerHTML = output; })  Enter 1-10 in the above box. It should output UUIDs."><link rel="stylesheet" href="https://iOliverNguyen.github.io/css/style-classic.css"><link rel="stylesheet" href="https://iOliverNguyen.github.io/style.css"><link rel="icon" type="image/png" href="/images/favicon.png"><link href="https://iOliverNguyen.github.io/w/wasmgo/index.xml" rel="alternate" type="application/rss+xml" title="Oliver Nguyen"><script async src="https://www.googletagmanager.com/gtag/js?id=G-L5X8RJDCLM"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-L5X8RJDCLM")</script><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">TIL: WASM with Go and run it inside browser</h1><div class="meta"><div class="postdate"><time datetime="2022-06-14 00:00:00 &#43;0000 UTC" itemprop="datePublished">2022-06-14</time></div><div class="article-tag">&nbsp;Â· <a class="tag-link" href="/w/#wasm" rel="tag">wasm</a></div></div></header><div class="content" itemprop="articleBody"><p><script src="/lib/wasm_exec.js"></script><script>const go=new Go;WebAssembly.instantiateStreaming(fetch("go/uuid.wasm"),go.importObject).then((t=>{go.run(t.instance)}))</script></p><div class="box" id="box1"><form><div class="line"><label>Number of UUIDs:</label> <input class="input" value="1"></div><div class="line"><input type="submit" value="Generate"></div><div class="output">&nbsp;</div></form></div><script>const form$=document.querySelector("#box1 form"),input$=document.querySelector("#box1 .input"),output$=document.querySelector("#box1 .output");console.log("xx"),form$.addEventListener("submit",(e=>{e.preventDefault(),console.log("xx");let t=wasmGenerateUUIDs(input$.value)||"&nbsp;";t=t.replaceAll("\n","<br>"),output$.innerHTML=t}))</script>Enter 1-10 in the above box. It should output UUIDs.<p></p><h3 id="writing-go-code">Writing Go code</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">func main<span class="o">()</span> <span class="o">{</span>
  <span class="k">done</span> :<span class="o">=</span> make<span class="o">(</span>chan struct<span class="o">{}</span>, 0<span class="o">)</span>
  js.Global<span class="o">()</span>.Set<span class="o">(</span><span class="s2">&#34;wasmGenerateUUIDs&#34;</span>, js.FuncOf<span class="o">(</span>generateUUIDs<span class="o">))</span>
  &lt;-done
<span class="o">}</span>

func generateUUIDs<span class="o">(</span>this js.Value, args <span class="o">[]</span>js.Value<span class="o">)</span> any <span class="o">{</span>
  <span class="k">if</span> len<span class="o">(</span>args<span class="o">)</span> <span class="o">==</span> <span class="m">0</span> <span class="o">{</span>
    <span class="k">return</span> uuid.NewString<span class="o">()</span>
  <span class="o">}</span>
  count, err :<span class="o">=</span> strconv.Atoi<span class="o">(</span>args<span class="o">[</span>0<span class="o">]</span>.String<span class="o">())</span>
  <span class="k">if</span> err !<span class="o">=</span> nil <span class="o">{</span>
    <span class="k">return</span> <span class="s2">&#34;ERROR: invalid number&#34;</span>
  <span class="o">}</span>
  <span class="k">if</span> count &gt; <span class="m">10</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s2">&#34;ERROR: too many&#34;</span>
  <span class="o">}</span>
  uuids :<span class="o">=</span> make<span class="o">([]</span>string, count<span class="o">)</span>
  <span class="k">for</span> i :<span class="o">=</span> 0<span class="p">;</span> i &lt; count<span class="p">;</span> i++ <span class="o">{</span>
    uuids<span class="o">[</span>i<span class="o">]</span> <span class="o">=</span> uuid.NewString<span class="o">()</span>
  <span class="o">}</span>
  <span class="k">return</span> strings.Join<span class="o">(</span>uuids, <span class="s2">&#34;\n&#34;</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div><p>And compile to WASM:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">GOOS</span><span class="o">=</span>js <span class="nv">GOARCH</span><span class="o">=</span>wasm go build -o static/main.wasm cmd/wasm/main.go
</code></pre></div><p>Hello</p><h3 id="run-it-in-the-browser">Run it in the browser</h3><p>Include <code>wasm_exec.js</code> provided by Go.</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">cp <span class="s2">&#34;</span><span class="k">$(</span>go env GOROOT<span class="k">)</span><span class="s2">/misc/wasm/wasm_exec.js&#34;</span> .
</code></pre></div><p>Create <code>index.html</code>:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;/lib/wasm_exec.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="kr">const</span> <span class="nx">go</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Go</span><span class="p">();</span>
  <span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">instantiateStreaming</span><span class="p">(</span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&#34;go/uuid.wasm&#34;</span><span class="p">),</span> <span class="nx">go</span><span class="p">.</span><span class="nx">importObject</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">instance</span><span class="p">);</span>
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div><p>And add JavaScript:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">wasmGenerateUUIDs</span><span class="p">(</span><span class="nx">input$</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="nx">output$</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">output</span><span class="p">.</span><span class="nx">replaceAll</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">);</span>
</code></pre></div><h2 id="author">Author</h2><p>I'm Oliver Nguyen. A software maker working mostly in Go and JavaScript. I enjoy learning and seeing a better version of myself each day. Occasionally spin off new open source projects. Share knowledge and thoughts during my journey. <span>Connect with me on <a class="icon" target="_blank" rel="noopener" href="https://github.com/iOliverNguyen"><i class="fab fa-github"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://linkedin.com/in/iOliverNguyen"><i class="fab fa-linkedin"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://x.com/_OliverNguyen"><i class="fab fa-twitter"></i> </a>, <a class="icon" target="_blank" rel="noopener" href="https://iOliverNguyen.medium.com"><i class="fab fa-medium-m"></i> </a>and <a class="icon" target="_blank" rel="noopener" href="mailto:iOliverNguyen@gmail.com"><i class="fas fa-envelope"></i> </a>.</span></p></div></article><div id="header-post"><a id="menu-icon" href="/w"><i class="fas fa-chevron-left fa-lg"></i> <span class="icon-text">Back</span></a> <a id="menu-icon-tablet" href="/w"><i class="fas fa-chevron-left fa-lg"></i> <span class="icon-text">Back</span></a></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul></ul></div><div id="toc-footer" class="tog-footer" style="display:none"><script>console.log("content",'<nav id="TableOfContents">\n  <ul>\n    <li>\n      <ul>\n        <li><a href="#writing-go-code">Writing Go code</a></li>\n        <li><a href="#run-it-in-the-browser">Run it in the browser</a></li>\n      </ul>\n    </li>\n  </ul>\n</nav>')</script><div class="toc-header"><a href="#">TIL: WASM with Go and run it inside browser</a></div><nav id="TableOfContents"><ul><li><ul><li><a href="#writing-go-code">Writing Go code</a></li><li><a href="#run-it-in-the-browser">Run it in the browser</a></li></ul></li></ul></nav></div><div id="share-footer" class="tog-footer" style="display:none"><ul><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fwasmgo%2f&title=TIL%3a%20WASM%20with%20Go%20and%20run%20it%20inside%20browser"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fwasmgo%2f"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://x.com/share?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fwasmgo%2f&text=TIL%3a%20WASM%20with%20Go%20and%20run%20it%20inside%20browser"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fwasmgo%2f&title=TIL%3a%20WASM%20with%20Go%20and%20run%20it%20inside%20browser"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fiOliverNguyen.github.io%2fw%2fwasmgo%2f&t=TIL%3a%20WASM%20with%20Go%20and%20run%20it%20inside%20browser"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="home" class="icon" href="/w"><i class="fas fa-chevron-left fa-lg" aria-hidden="true"></i> Back</a> <a id="toc" class="icon" href="#" onclick='return $(".tog-footer").toggle(),!1'><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a> <a id="share" class="icon" href="#" onclick='return $(".tog-footer").toggle(),!1'><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2024 Oliver Nguyen.</div><div class="footer-right"><nav><ul></ul></nav></div></footer></div></body><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script src="/lib/jquery/jquery.min.js"></script><script src="/js/main.js"></script></html>